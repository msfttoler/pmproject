# Demo Workflow: Feature Branch Validation
# This workflow demonstrates PM Command Center's CI/CD monitoring capabilities
# Triggers on feature branches to show active development tracking

name: ðŸš€ Feature Validation

on:
  push:
    branches:
      - 'feature/**'
      - 'demo-*'
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  validate:
    name: ðŸ“‹ Validate Feature
    runs-on: ubuntu-latest
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ“š Install dependencies
        run: npm ci

      - name: ðŸ” Run linter
        run: npm run lint --if-present

      - name: ðŸ§ª Run unit tests
        run: npm test --if-present

      - name: ðŸ—ï¸ Build application
        run: npm run build

      - name: ðŸ“Š Generate build summary
        run: |
          echo "## ðŸš€ Feature Validation Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Check | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| Lint | âœ… Passed |" >> $GITHUB_STEP_SUMMARY
          echo "| Tests | âœ… Passed |" >> $GITHUB_STEP_SUMMARY
          echo "| Build | âœ… Passed |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Ready for PM review in **PM Command Center** ðŸŽ¯" >> $GITHUB_STEP_SUMMARY

  analyze:
    name: ðŸ“ˆ Code Analysis
    runs-on: ubuntu-latest
    needs: validate
    
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ðŸ“Š Count lines of code
        run: |
          echo "## ðŸ“Š Code Statistics" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Metric | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|-------|" >> $GITHUB_STEP_SUMMARY
          JS_LINES=$(find src -name "*.js" -o -name "*.jsx" | xargs wc -l 2>/dev/null | tail -1 | awk '{print $1}' || echo "0")
          echo "| JavaScript/JSX | $JS_LINES lines |" >> $GITHUB_STEP_SUMMARY
          TS_LINES=$(find . -name "*.ts" -o -name "*.tsx" | xargs wc -l 2>/dev/null | tail -1 | awk '{print $1}' || echo "0")
          echo "| TypeScript | $TS_LINES lines |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "View this in **@pm /cicd** ðŸ”§" >> $GITHUB_STEP_SUMMARY
